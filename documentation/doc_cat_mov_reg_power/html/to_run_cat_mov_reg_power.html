
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>To run cat_mov_reg_power.m</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-07-16"><meta name="DC.source" content="to_run_cat_mov_reg_power.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>To run cat_mov_reg_power.m</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Credit and date</a></li><li><a href="#2">Intro</a></li><li><a href="#3">Dependencies:</a></li><li><a href="#4">Basic usage</a></li><li><a href="#5">Example 1</a></li><li><a href="#7">Advanced usage, matching the colormap for different filtering strategies</a></li><li><a href="#8">Run the loop for the first time to pick the scale</a></li><li><a href="#9">Re run the loop selecting your prefered color</a></li></ul></div><h2 id="1">Credit and date</h2><p>Code developed by Oscar Miranda-Dominguez.</p><h2 id="2">Intro</h2><p>This function concatenate the relative contribution of power of each frequency band from multiple subjects.</p><h2 id="3">Dependencies:</h2><p>Before using it, make sure you have the functions this code needs:</p><div><ul><li>importMovReg_patch.m | in rushmore: /mnt/max/shared/projects/filtering_movement_regressors/matlab_code/importMovReg_patch.m</li><li>calc_FD_HCP.m | in rushmore: /mnt/max/shared/code/internal/utilities/framewise_displacement/calc_FD_HCP.m</li><li>cat_mov_reg_power.m | in rushmore: /mnt/max/shared/code/internal/utilities/mov_reg_power/cat_mov_reg_power.m</li><li>make_friston_regressors | in rushmore: /mnt/max/shared/utilities/HCP_Matlab/make_friston_regressors.m</li></ul></div><h2 id="4">Basic usage</h2><p>The two mandatory input arguments for this function are:</p><div><ol><li>the path to the Movement Regressors files made by the pipeline, formatted as a cell of size nx1, where n represents the number of files</li><li>TR, BOLD's repetition time</li></ol></div><h2 id="5">Example 1</h2><p>To run this example, you need to have the movement regressors files used for the power analysis. We are including in this documentation Movement regressors files from 63 participants with 4 resting state scans each. Hence we have 252 (63x4=252) Movement regressors files. Furthermore, the data was processed using 3 different methods, or versions:</p><div><ul><li>ver1: No filtering</li><li>ver2: applying a notch filter with fixed cutting frequencies located at 0.31 and 0.43 HZ to the estimations of head movement (Movement regressors files)</li><li>ver3: applying a notch filter to the estimations of head movement but selecting the filter bandwidth based on "guesing" the participant's respiration rate.</li></ul></div><p>The movement regressors files for the  3 versions are saved on the folders ver1, ver2, and ver3. The files paths_v1_native_folder.mat, paths_v2_native_folder.mat, and paths_v3_native_folder.mat have the paths to those files. You might need to update those paths accordingly to the location of the files in your system</p><p>Here is the first example:</p><p>Adding paths | Update this accordingly to your system</p><pre class="codeinput">addpath(<span class="string">'/mnt/max/shared/code/internal/utilities/framewise_displacement/'</span>);
addpath(<span class="string">'/mnt/max/shared/code/internal/utilities/mov_reg_power/'</span>);
addpath(<span class="string">'/mnt/max/shared/projects/filtering_movement_regressors/matlab_code/'</span>);
addpath(<span class="string">'/mnt/max/shared/utilities/HCP_Matlab/'</span>);

<span class="comment">% cd /mnt/max/shared/code/internal/utilities/mov_reg_power % move to the folder to save the data</span>
f=filesep;
TR=0.8;<span class="comment">% TR in seconds</span>

ver=1;
filename=[<span class="string">'paths_v'</span> num2str(ver) <span class="string">'_local_folder.mat'</span>];
load(filename)

[CLIM, ix_subject_scan,MU,SIGMA,P]=cat_mov_reg_power(paths,TR);
</pre><img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_01.png" alt=""> <p>This figure shows the power spectrum of the 252 unique scans, sorted by mean frame displacement. Each subplot indicates the direction of the displacement</p><h2 id="7">Advanced usage, matching the colormap for different filtering strategies</h2><p>If you like to use the same colormap and scaling using from one filtering strategy on the other filtering versions, you need to run the function first using the oputput arguments of the function and then run the function again using those output arguments as input arguments</p><h2 id="8">Run the loop for the first time to pick the scale</h2><pre class="codeinput">CLIM=zeros(3,6,2);
IX=cell(3,1);
MU=cell(3,1);
SIGMA=cell(3,1);
P=cell(3,1);
<span class="keyword">for</span> ver=1:3
    filename=[<span class="string">'paths_v'</span> num2str(ver) <span class="string">'_local_folder.mat'</span>];
    load(filename)

    tit_preffix=[<span class="string">'FNL_ver'</span> num2str(ver) <span class="string">'_autoscale_'</span>];
    [CLIM(ver,:,:), IX{ver},MU{ver},SIGMA{ver},P{ver}]=cat_mov_reg_power(paths,0.8,<span class="string">'tit_preffix'</span>,tit_preffix);

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_02.png" alt=""> <img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_03.png" alt=""> <img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_04.png" alt=""> <h2 id="9">Re run the loop selecting your prefered color</h2><pre class="codeinput">pick=1;
same_CLIM=squeeze(CLIM(pick,:,:));




<span class="keyword">for</span> ver=1:3
    filename=[<span class="string">'paths_v'</span> num2str(ver) <span class="string">'_local_folder.mat'</span>];
    load(filename)

    tit_preffix=[<span class="string">'FNL_ver'</span> num2str(ver) <span class="string">'_same_scale_as_Ver1_'</span>];
    ix=IX{pick};
    mu=MU{pick};
    sigma=SIGMA{pick};
    p=P{pick};
    cat_mov_reg_power(paths,0.8,<span class="keyword">...</span>
        <span class="string">'tit_preffix'</span>,tit_preffix,<span class="keyword">...</span>
        <span class="string">'clim'</span>,same_CLIM,<span class="keyword">...</span>
        <span class="string">'ix_subject_scan'</span>,ix,<span class="keyword">...</span>
        <span class="string">'MU'</span>,mu,<span class="keyword">...</span>
        <span class="string">'SIGMA'</span>,sigma,<span class="keyword">...</span>
        <span class="string">'P'</span>,p);

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_05.png" alt=""> <img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_06.png" alt=""> <img vspace="5" hspace="5" src="to_run_cat_mov_reg_power_07.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% To run cat_mov_reg_power.m
%
%% Credit and date
% Code developed by Oscar Miranda-Dominguez. 
%% Intro
% This function concatenate the relative contribution of power of each
% frequency band from multiple subjects.
%
%% Dependencies:
%
% Before using it, make sure you have the functions this code needs:
%
% * importMovReg_patch.m | in rushmore: /mnt/max/shared/projects/filtering_movement_regressors/matlab_code/importMovReg_patch.m
% * calc_FD_HCP.m | in rushmore: /mnt/max/shared/code/internal/utilities/framewise_displacement/calc_FD_HCP.m
% * cat_mov_reg_power.m | in rushmore: /mnt/max/shared/code/internal/utilities/mov_reg_power/cat_mov_reg_power.m
% * make_friston_regressors | in rushmore: /mnt/max/shared/utilities/HCP_Matlab/make_friston_regressors.m
%
% 
%% Basic usage
% 
% The two mandatory input arguments for this function are:
%
% # the path to the Movement Regressors files made by the pipeline,
% formatted as a cell of size nx1, where n represents the number of files
% # TR, BOLD's repetition time
%
%% Example 1
%
% To run this example, you need to have the movement regressors files used
% for the power analysis. We are including in this documentation Movement
% regressors files from 63 participants with 4 resting state scans each.
% Hence we have 252 (63x4=252) Movement regressors files. Furthermore, the
% data was processed using 3 different methods, or versions:
%
% * ver1: No filtering 
% * ver2: applying a notch filter with fixed cutting frequencies located at
% 0.31 and 0.43 HZ to the estimations of head movement (Movement regressors
% files)
% * ver3: applying a notch filter to the estimations of head movement but
% selecting the filter bandwidth based on "guesing" the participant's
% respiration rate. 
%  
% The movement regressors files for the  3 versions are saved on the
% folders ver1, ver2, and ver3. The files paths_v1_native_folder.mat,
% paths_v2_native_folder.mat, and paths_v3_native_folder.mat have the paths
% to those files. You might need to update those paths accordingly to the
% location of the files in your system
%
% Here is the first example:
% 
% Adding paths | Update this accordingly to your system
addpath('/mnt/max/shared/code/internal/utilities/framewise_displacement/');
addpath('/mnt/max/shared/code/internal/utilities/mov_reg_power/');
addpath('/mnt/max/shared/projects/filtering_movement_regressors/matlab_code/');
addpath('/mnt/max/shared/utilities/HCP_Matlab/');

% cd /mnt/max/shared/code/internal/utilities/mov_reg_power % move to the folder to save the data
f=filesep;
TR=0.8;% TR in seconds

ver=1;
filename=['paths_v' num2str(ver) '_local_folder.mat'];
load(filename)

[CLIM, ix_subject_scan,MU,SIGMA,P]=cat_mov_reg_power(paths,TR);
%%
% This figure shows the power spectrum of the 252 unique scans, sorted by
% mean frame displacement. Each subplot indicates the direction of the
% displacement
%
%% Advanced usage, matching the colormap for different filtering strategies
%
% If you like to use the same colormap and scaling using from one filtering
% strategy on the other filtering versions, you need to run the function
% first using the oputput arguments of the function and then run the
% function again using those output arguments as input arguments

%% Run the loop for the first time to pick the scale

CLIM=zeros(3,6,2);
IX=cell(3,1);
MU=cell(3,1);
SIGMA=cell(3,1);
P=cell(3,1);
for ver=1:3
    filename=['paths_v' num2str(ver) '_local_folder.mat'];
    load(filename)
    
    tit_preffix=['FNL_ver' num2str(ver) '_autoscale_'];
    [CLIM(ver,:,:), IX{ver},MU{ver},SIGMA{ver},P{ver}]=cat_mov_reg_power(paths,0.8,'tit_preffix',tit_preffix);
    
end

%% Re run the loop selecting your prefered color
pick=1;
same_CLIM=squeeze(CLIM(pick,:,:));




for ver=1:3
    filename=['paths_v' num2str(ver) '_local_folder.mat'];
    load(filename)
    
    tit_preffix=['FNL_ver' num2str(ver) '_same_scale_as_Ver1_'];
    ix=IX{pick};
    mu=MU{pick};
    sigma=SIGMA{pick};
    p=P{pick};
    cat_mov_reg_power(paths,0.8,...
        'tit_preffix',tit_preffix,...
        'clim',same_CLIM,...
        'ix_subject_scan',ix,...
        'MU',mu,...
        'SIGMA',sigma,...
        'P',p);
    
end

##### SOURCE END #####
--></body></html>